---
layout: single
title:  "EKA2L1 versione 0.0.4 rilasciata!"
date:   2021-05-20 9:00:00 +0700
categories: update android playstore
toc: true
---

EKA2L1 è stato aggiornato alla versione 0.0.4, anche sul Google Play Store.

## Migliorie ai metodi di installazione del dispositivo

Ci sono stati dei feedback riguardo la difficoltà di capire cosa fare. Per esempio, quando compare la schermata di installazione, che dispositivo dev'essere installato, e che metodo usare? Molti utenti si fermano di fronte a questi passaggi, e molti utenti Android sono semplici consumatori, non smanettano quanto gli utenti PC.

Il risultato è che abbiamo modificato il processo di installazione del dispositivo. Si noti che non può essere rimosso del tutto.

- Sappiamo che in molti sono appassionati di console, non di Symbian, quindi per loro avere due file diversi o qualcosa come il dump grezzo può essere un po' difficile. Quindi, per i dispositivi **S60v1**, come *N-Gage*, ora è richiesta **solo** la **ROM di sistema** per l'installazione. Speriamo che questo faciliti il processo di installazione.
- Per i dispositivi S60v2, esistono processi di transizione che coinvolgono anche ROFS nei tuoi sistemi, quindi è comunque necessario utilizzare RPKG per questi.
- Per i dispositivi S60v3, S60v5 e S^3, abbiamo fornito la possibilità di **installare utilizzando i firmware**. Questo è più conosciuto tra le persone e dovrebbe essere raccomandato. Devi solo **fornire il percorso del file VPL** per l'installazione. *Nota* che questo non funziona con alcuni firmware S60v2 più recenti, a causa delle differenze nel posizionamento dei dati della ROM.

Riguardo a quali dispositivi installare, abbiamo aggiunto una sezione espandibile su cui è possibile fare clic, che consiglierà i dispositivi da installare e quali metodi utilizzare per essi.

Ecco le immagini della nuova schermata di installazione:

<figure class="">
	<img src="https://cdn.discordapp.com/attachments/786228834638626867/844785034178986004/Screenshot_20210520-105346_EKA2L1.jpg">
	<figcaption>Schermata di installazione del dispositivo su Android</figcaption>
</figure>

<figure class="">
	<img src="https://user-images.githubusercontent.com/25717050/118917060-445be380-b95a-11eb-8a70-6c4c8bb71578.png">
	<figcaption>Schermata di installazione del dispositivo su PC</figcaption>
</figure>

Quando viene rilevato che la ROM non è S60v1, verrà richiesto il campo RPKG. Grazie agli utenti su Play Store e su Discord per aver espresso le loro difficoltà.

## Aggiunto il supporto fondamentale per S60v2

Questo è stato richiesto da molte persone. L'emulatore ha implementato alcune parti dei sistemi S60v2, ma sfortunatamente non tutte, e molte app e giochi sono ancora buggati pesantemente o non si avviano proprio. Tuttavia, la compatibilità è migliorata.

S60v2 ha tre pacchetti di funzionalità, in cui sono presenti le fasi di transizione dai giorni passati di EPOC. Ciò include il tentativo di rimuovere la struttura delle cartelle di sistema, la rimozione di ricerche DLL simili a quelle di Windows, la rimozione di apprun, e modifiche alla ROM (es. forzare la risoluzione dello schermo dall'interno degli header della ROM). Per questo, implementare S60v2 è divertente.

Anche la compressione dei DLL ed EXE PETRAN è presente in molte applicazioni. Alcune funzionalità che continuano a non funzionare correttamente comprendono i giochi che utilizzano Direct Screen Access (DSA).

Ecco alcuni screenshot di giochi attualmente funzionanti nell'emulatore, utilizzando un dump del dispositivo N70.

<figure class="third">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/840340705734033519/Screenshot_20210508-043257910.jpg">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/835925072249618452/88.png">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/835931179512496148/Screenshot_20210426-003110162.jpg">
	<figcaption>Immagini fornite da ericsonia e Ink321</figcaption>
</figure>

<figure class="third">
	<img src="https://media.discordapp.net/attachments/703563521379663883/835942982699974686/Screenshot_20210426-011828204.jpg?width=285&height=593">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/835918650602553424/7.png">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/835917090761342976/Screenshot_20210425-233538114.jpg">
	<figcaption>Immagini fornite da ericsonia e Ink321</figcaption>
</figure>

## Adding S60v5 support on 32-bit

S60v5 and S^3 requires heavy VFP operations, so it was not implemented in emulator 32-bit JIT before. Recently we touch it again, since the host doesn't use VFP registers at all, we trash the whole register bank, but still keep track of what registers are being loaded/written.

The performance getting with the 32-bit JIT is actually, same as on real phone. I don't think there's much room of expectation for ameturers like us... But we hope you can enjoy the good old days applications on new Android phone. There is nothing much to talk about this.

## Other small fixes

No unicode device dumps have been around before, but recently we was given a N70 Chinese ROMs, and it does not work very well, for the fact that it does not display anything to read. When digging into it, we tried to load Unicode characters, but not storing their coordinates information in the font texture atlas at all. So fixing this make a guy able to play Pocket Kingdom in Chinese, LOL.

<figure class="half">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/841236525442400256/Screenshot_20210510_165245_com.github.eka2l1.jpg">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/841206165320237126/unknown.png">
	<figcaption>The story seems to be able to display now, you can also play Card Decks</figcaption>
</figure>

Other requested things, included some games not able to read the emulator's IMEI at all. This IMEI is randomly generated online, LOL. But there should not be anything wrong with it.

To get the IMEI, games must open phone information using an API, which requires you to provide the phone information's getter name (this is instantiated from a DLL). But these old games sometimes just hardcoded that getter name to either "Calypso" for S60v1 (this is the codename of Nokia 7650), or "DefaultPhone" on S60v2. We don't load these modules for the obivious reasons, that it's getting things from driver. So we have to fake those names depend on the OS versions...
  
<figure class="half">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/837025442631516170/111.png">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/837031936668467210/78.png">
	<figcaption>You can play Legacy now... And reading IMEI from X-plore also works</figcaption>
</figure>
  
Last thing to mention is that, some games have some race conditons, that does not ever trigger because of the way OS schedules thread. After a thread is created and resumed, the kernel will immediate reschedule, which may make child thread runs first. This creates some situations where the parent thread access data by the child thread that is only created when the child thread runs first. The emulator is corrected to follow this behaviour, which fixed crash in some games.

<figure class="half">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/840313459240992808/Screenshot_20210508-023938077.jpg">
	<img src="https://cdn.discordapp.com/attachments/703563521379663883/840298370576810045/78.png">
	<figcaption>Spider Man: Toxic City and Virtuous Devil Saga now works fine</figcaption>
</figure>
  
There are also some small fixes that improve more compabilities with S60v3 and S60v5 applications, but we won't mention here.
  
## Goals for 0.0.5
  
We hope to implement N-Gage serivce support (people usually called it N-Gage 2.0) soon. There has been works in ng2 branch before, but it's very hacky and only works with one game, and that only mentioning installation of it.

![image](https://user-images.githubusercontent.com/25717050/118920571-de268f00-b960-11eb-8f52-87cb082dc09c.png)
  
We also want to fix the problems of file operations taking enternity on Android 11 currently, or barely functional at all. A fix will be issued when we find the time.

## Closing notes
  
The PC version will have the same quality of life changes as Android, this is being implemented at the moment. But for Android, you can find the stable version of the emulator on [Play Store](https://play.google.com/store/apps/details?id=com.github.eka2l1). Hope you have good time with the emulator.
